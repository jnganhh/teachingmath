<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPM2D Factoring Master</title>
    
    <!-- 1. Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- 3. Babel for translating JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom bounce animation for success */
        @keyframes bounce-small {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce-small {
            animation: bounce-small 2s infinite;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS (Inline SVGs to remove external dependencies) ---
        const Icon = ({ path, color = "currentColor", className = "w-5 h-5" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Brain: <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z" />,
            Trophy: <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6 M18 9h1.5a2.5 2.5 0 0 0 0-5H18 M4 22h16 M2 12h.01 M22 12h.01 M12 2a7 7 0 0 0-7 7v7h14v-7a7 7 0 0 0-7-7Z" />,
            Lightbulb: <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5 M9 18h6 M10 22h4" />,
            Check: <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14 M22 4 12 14.01l-3-3" />,
            X: <><circle cx="12" cy="12" r="10" /><path d="m15 9-6 6 M9 9l6 6" /></>,
            Right: <path d="m9 18 6-6-6-6" />
        };

        // --- LOGIC ---

        const generateProblem = (tier) => {
            let p, q, r, s;
            
            if (tier === 1) { // Simple a=1
                p = 1; r = 1;
                q = Math.floor(Math.random() * 5) + 1;
                s = Math.floor(Math.random() * 5) + 1;
            } else if (tier === 2) { // Signs a=1
                p = 1; r = 1;
                q = Math.floor(Math.random() * 9) - 4; if (q === 0) q = 1;
                s = Math.floor(Math.random() * 9) - 4; if (s === 0) s = 1;
            } else if (tier === 3) { // Prime a > 1
                p = Math.floor(Math.random() * 2) + 2;
                r = 1;
                q = Math.floor(Math.random() * 7) - 3; if (q === 0) q = 1;
                s = Math.floor(Math.random() * 7) - 3; if (s === 0) s = 1;
            } else { // Composite/Hard
                p = Math.floor(Math.random() * 3) + 2;
                r = Math.floor(Math.random() * 2) + 1;
                q = Math.floor(Math.random() * 11) - 5; if (q === 0) q = 1;
                s = Math.floor(Math.random() * 11) - 5; if (s === 0) s = 1;
                if (p * r === 1) p = 2;
            }

            return {
                a: p * r,
                b: (p * s) + (q * r),
                c: q * s,
                factors: { p, q, r, s },
                id: Date.now()
            };
        };

        // --- APP COMPONENT ---

        function App() {
            const [tier, setTier] = useState(1);
            const [problem, setProblem] = useState(null);
            const [inputs, setInputs] = useState({ tl: '', tr: '', bl: '', br: '' });
            const [feedback, setFeedback] = useState({ type: 'neutral', message: 'Ready to start!' });
            const [stats, setStats] = useState({ solved: 0, streak: 0, xp: 0 });

            // Load/Save Logic
            useEffect(() => {
                const saved = localStorage.getItem('mpm2d-stats');
                if (saved) setStats(JSON.parse(saved));
                newProblem(1);
            }, []);

            useEffect(() => {
                localStorage.setItem('mpm2d-stats', JSON.stringify(stats));
            }, [stats]);

            const newProblem = (selectedTier = tier) => {
                const p = generateProblem(selectedTier);
                setProblem(p);
                setInputs({ tl: '', tr: '', bl: '', br: '' });
                setFeedback({ type: 'neutral', message: 'Factor the trinomial below.' });
            };

            const handleInputChange = (field, value) => {
                if (value === '' || /^-?\d*$/.test(value)) {
                    setInputs(prev => ({ ...prev, [field]: value }));
                }
            };

            const checkAnswer = () => {
                if (!problem) return;
                const userP = parseInt(inputs.tl) || (inputs.tl === '0' ? 0 : 1);
                const userQ = parseInt(inputs.tr) || 0;
                const userR = parseInt(inputs.bl) || (inputs.bl === '0' ? 0 : 1);
                const userS = parseInt(inputs.br) || 0;

                const userA = userP * userR;
                const userC = userQ * userS;
                const userB = (userP * userS) + (userQ * userR);

                if (userA === problem.a && userB === problem.b && userC === problem.c) {
                    setFeedback({ type: 'success', message: 'Correct! Excellent factoring.' });
                    setStats(prev => ({
                        solved: prev.solved + 1,
                        streak: prev.streak + 1,
                        xp: prev.xp + (10 * tier) + (prev.streak * 2)
                    }));
                } else {
                    let msg = "Incorrect. ";
                    if (userA !== problem.a) msg += `Your x-terms multiply to ${userA}xÂ², but we need ${problem.a}xÂ².`;
                    else if (userC !== problem.c) msg += `Your constants multiply to ${userC}, but we need ${problem.c}.`;
                    else {
                        msg += `Diagonals sum to ${userB}x. We need ${problem.b}x. `;
                        if (userB === -problem.b) msg += "Check your signs!";
                        else msg += "Try swapping the constant numbers.";
                    }
                    setFeedback({ type: 'error', message: msg });
                    setStats(prev => ({ ...prev, streak: 0 }));
                }
            };

            const giveHint = () => {
                if (!problem) return;
                const { p, q, r, s } = problem.factors;
                setFeedback({ type: 'info', message: `Hint: One diagonal product is ${(p*s)}x or ${(q*r)}x.` });
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans flex flex-col items-center">
                    
                    {/* Header */}
                    <header className="w-full max-w-md bg-indigo-600 text-white p-4 shadow-lg rounded-b-2xl mb-6">
                        <div className="flex justify-between items-center mb-2">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon path={Icons.Brain} /> Factoring AI
                            </h1>
                            <div className="flex items-center gap-2 text-sm bg-indigo-700 px-3 py-1 rounded-full">
                                <Icon path={Icons.Trophy} className="w-4 h-4 text-yellow-300" />
                                <span className="font-mono">{stats.xp} XP</span>
                            </div>
                        </div>
                        
                        <div className="flex justify-between items-center text-indigo-100 text-sm">
                            <div className="flex gap-4">
                                <span>Solved: {stats.solved}</span>
                                <span className={stats.streak > 2 ? 'text-orange-300 font-bold' : ''}>
                                    Streak: {stats.streak} ðŸ”¥
                                </span>
                            </div>
                            <select 
                                value={tier} 
                                onChange={(e) => {
                                    const t = parseInt(e.target.value);
                                    setTier(t);
                                    newProblem(t);
                                }}
                                className="bg-indigo-800 border-none text-white text-xs rounded px-2 py-1"
                            >
                                <option value={1}>Lvl 1: Simple</option>
                                <option value={2}>Lvl 2: Signs</option>
                                <option value={3}>Lvl 3: Prime a</option>
                                <option value={4}>Lvl 4: Hard</option>
                            </select>
                        </div>
                    </header>

                    {/* Main Card */}
                    {problem && (
                        <main className="w-full max-w-md px-4 pb-20">
                            <div className="bg-white rounded-2xl shadow-md p-6 mb-6 border border-slate-200">
                                <div className="text-center mb-8">
                                    <p className="text-slate-500 text-xs uppercase tracking-wider font-bold mb-2">Factor This</p>
                                    <div className="text-3xl font-serif tracking-wide text-slate-800">
                                        <span className="text-indigo-600 font-bold">{problem.a === 1 ? '' : problem.a}</span>xÂ²
                                        <span className="text-emerald-600 font-bold"> {problem.b >= 0 ? '+' : '-'} {Math.abs(problem.b)}</span>x
                                        <span className="text-blue-600 font-bold"> {problem.c >= 0 ? '+' : '-'} {Math.abs(problem.c)}</span>
                                    </div>
                                </div>

                                {/* Criss Cross Grid */}
                                <div className="relative flex justify-center mb-8 select-none">
                                    <svg className="absolute top-0 left-0 w-full h-full pointer-events-none" style={{zIndex: 0}}>
                                        <line x1="35%" y1="20%" x2="65%" y2="80%" stroke="#e2e8f0" strokeWidth="4" />
                                        <line x1="35%" y1="80%" x2="65%" y2="20%" stroke="#e2e8f0" strokeWidth="4" />
                                    </svg>

                                    <div className="grid grid-cols-2 gap-x-8 gap-y-6 relative z-10">
                                        {['tl', 'tr', 'bl', 'br'].map((pos, i) => (
                                            <div key={pos} className="flex flex-col items-center gap-1">
                                                <div className={`flex items-center bg-slate-50 border-2 rounded-xl overflow-hidden focus-within:ring-2 transition-all ${i % 2 === 0 ? 'border-indigo-200 focus-within:ring-indigo-400' : 'border-blue-200 focus-within:ring-blue-400'}`}>
                                                    {i % 2 !== 0 && <div className="bg-blue-50 text-blue-400 h-12 flex items-center justify-center px-2 font-bold">+</div>}
                                                    <input 
                                                        type="tel" 
                                                        className="w-12 h-12 text-center text-xl font-bold bg-transparent outline-none text-slate-700"
                                                        placeholder="?"
                                                        value={inputs[pos]}
                                                        onChange={(e) => handleInputChange(pos, e.target.value)}
                                                    />
                                                    {i % 2 === 0 && <div className="bg-indigo-100 text-indigo-700 h-12 flex items-center justify-center px-2 font-serif italic">x</div>}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="text-center p-2 bg-slate-50 rounded mb-4 text-slate-500 font-mono text-xs">
                                    ({inputs.tl || '?'}x {parseInt(inputs.tr) >= 0 ? '+' : ''}{inputs.tr || '?'}) ({inputs.bl || '?'}x {parseInt(inputs.br) >= 0 ? '+' : ''}{inputs.br || '?'})
                                </div>

                                {/* Feedback */}
                                <div className={`p-3 rounded-lg text-sm flex items-start gap-3 ${
                                    feedback.type === 'error' ? 'bg-red-50 text-red-800' :
                                    feedback.type === 'success' ? 'bg-emerald-50 text-emerald-800' :
                                    feedback.type === 'info' ? 'bg-yellow-50 text-yellow-800' :
                                    'bg-slate-50 text-slate-600'
                                }`}>
                                    <div className="mt-0.5">
                                        {feedback.type === 'error' && <Icon path={Icons.X} className="w-5 h-5" />}
                                        {feedback.type === 'success' && <Icon path={Icons.Check} className="w-5 h-5" />}
                                        {feedback.type === 'info' && <Icon path={Icons.Lightbulb} className="w-5 h-5" />}
                                        {feedback.type === 'neutral' && <Icon path={Icons.Brain} className="w-5 h-5" />}
                                    </div>
                                    <p>{feedback.message}</p>
                                </div>
                            </div>

                            {/* Controls */}
                            <div className="grid grid-cols-2 gap-4">
                                <button onClick={giveHint} className="flex items-center justify-center gap-2 py-3 px-4 rounded-xl bg-white border border-slate-200 text-slate-700 font-semibold shadow-sm active:scale-95 transition-transform">
                                    <Icon path={Icons.Lightbulb} className="w-5 h-5 text-yellow-500" /> Hint
                                </button>

                                {feedback.type === 'success' ? (
                                    <button onClick={() => newProblem()} className="flex items-center justify-center gap-2 py-3 px-4 rounded-xl bg-emerald-600 text-white font-bold shadow-md active:scale-95 transition-transform">
                                        Next <Icon path={Icons.Right} />
                                    </button>
                                ) : (
                                    <button onClick={checkAnswer} className="flex items-center justify-center gap-2 py-3 px-4 rounded-xl bg-indigo-600 text-white font-bold shadow-md active:scale-95 transition-transform">
                                        Check
                                    </button>
                                )}
                            </div>
                        </main>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>